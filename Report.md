# Headless-браузери: що це таке та чим вони корисні для тестувальника
## І. Вступ

![image](https://user-images.githubusercontent.com/54907481/119243837-100f3f80-bb73-11eb-9cd5-984c70799e23.png)

Під кінець майже кожного проєкту єдиними тестами, які мають значення, є наскрізні тести користувацького інтерфейсу. Це тести, які доводять, що програма - з усіма своїми подіями, функціями та мікросервісами - дозволяє **зацікавленим сторонам досягти всіх своїх цілей.**

Але існують деякі невід'ємні проблеми з тестуванням на основі інтерфейсу користувача. 
1. **Стабільність**: навіть коли додаток працює коректно, тести користувацького інтерфейсу іноді не вдаються під час взаємодії з браузером. 
2. **Ефективність**: тестування користувацького інтерфейсу - це НАДЗВИЧАЙНО ПОВІІІІІІІІІІЛЬНЕ заняття в порівнянні з іншими видами автоматизованого тестування.

### Що таке тестування сайту "без голови"?
Є рішення: тестування з використанням **headless-браузеру**. 
Headless тестування - це спосіб запуску тестів інтерфейсу браузера без "голови", що в цьому випадку означає, що немає ЖОДНОГО графічного інтерфейсу. Це корисно, оскільки під час запуску тестів ви не «*спостерігаєте*» за візуальними елементами, тому немає необхідності мати додаткові витрати на графічний інтерфейс веб-сайту.

Як і звичайний браузер, **headless браузер** може аналізувати та інтерпретувати веб-сторінки (хоча поведінка може відрізнятися між різними реалізаціями браузера), тому він може забезпечити реальний контекст браузера без будь-яких витрат в пам'яті та швидкості запуску повноцінного браузера з графічним інтерфейсом .
>Наприклад, headless браузер повинен мати можливість аналізу JavaScript, натискання на посилання, боротьби з будь-якими завантаженнями тощо. Запуск headless браузера зазвичай означає, що тести будуть проводитись через інтерфейс командного рядка або за допомогою мережевого зв'язку.

___
### Headless тестування: де це можна використовувати?
1. Автоматизація
Оскільки headless браузери можуть забезпечувати управління веб-сторінками, їх можна використовувати для автоматизації завдань, сценаріїв та тестів користувальницького інтерфейсу щодо браузера без необхідності запускати користувальницький інтерфейс сайту. 

2. Тестування макету
Headless тестування може полегшити багато перевірок макету, оскільки headless реалізації можуть відображати та інтерпретувати HTML та CSS як справжній браузер. Це означає, що можна протестувати такі елементи стилю, як макети сторінок (наприклад, визначення ширини сторінки за замовчуванням, координати місця знаходження елемента), вибір кольору для будь-яких елементів, використовуваний шрифт тощо.

3. Вилучення даних
Можливо, вам не хочеться запустити повний веб-сайт, зайти на нього та вилучити для себе певну інформацю. Набагато простіше і швидше перейти до веб-сайту "безголово", вилучити дані та використовувати результати для тестування декількох веб-сторінок.

4. Продуктивність
Headless браузери швидші за справжні браузери, оскільки не мають усіх накладних витрат на запуск графічного інтерфейсу сторінки, і це прирівнюється до швидших результатів ваших тестів.  Можливість виконувати завдання за допомогою командного рядка без необхідності оновлювати сторінку вручну або запускати браузер може заощадити багато зусиль.

___
## IІ. Headless тестування за допомогою PhantomJS
![image](https://user-images.githubusercontent.com/54907481/119244588-caef0b80-bb7a-11eb-851f-e40688a1e348.png)

>PhantomJS являє собою WebKit без вікна з API JavaScript.

Як ми знаємо, **Webkit** - це механізм компонування, який використовують Chrome, Safari і кілька інших браузерів. Отже, PhantomJS - це браузер, але без активного вікна. Це означає, що веб-сторінки, що переглядаються  ніколи не відображаються. Це може здатися  дивним, тому розглядаємо його як програмований браузер для терміналу. Ми зовсім скоро розглянемо простий приклад, але спочатку нам потрібно встановити ***PhantomJS***.
### Встановлення PhantomJS
Встановлення PhantomJS насправді досить просте: це всього лише один бінарний файл, який ви завантажуєте і вставляєте в свій path. На [сторінці завантаження PhantomJS][1] виберіть свою операційну систему і завантажте необхідний пакет. Все! 
Все, що залишилось — розархівувати архів до потрібної директорії, додати директорію до файлу `phantomjs.exe` в `path` та запустити термінал в папці з файлом `phantomjs.exe`.
>Запускати `phantomjs.exe` НЕ ПОТРІБНО, це інтерпретатор

З'явиться така консоль (на всі мої Z на скріншотах не звертайте уваги, гарячі клавіші мого скріншотеру прив'язані до цієї клавіші):
![image](https://user-images.githubusercontent.com/54907481/119245049-b6ad0d80-bb7e-11eb-962a-16983e1e895b.png)

Якщо ви працюєте в Mac OS X, існує більш простий спосіб установки PhantomJS. Просто використовуйте Homebrew, ось так:
```
brew update && brew install phantomjs
```
Тепер ви повинні встановити PhantomJS. Ви можете двічі перевірити своє встановлення, виконавши такі дії:
```
phantomjs --version
```
### Маленький приклад
Почнемо з невеликого прикладу.

***simple.js***

```
console.log("we can log stuff out.");

function add(a, b) {
    return a + b;
}
console.log("We can execute regular JS too:", add(1, 2));
phantom.exit();
```
Продовжуйте і запустіть цей код, виконавши наступну команду:
```
phantomjs simple.js
```
Отримаємо:
![image](https://user-images.githubusercontent.com/54907481/119245430-02ad8180-bb82-11eb-9e71-d6347f6b6d0b.png)
Звичайно, це простий, але це хороший момент: PhantomJS може виконувати JavaScript так само, як браузер. Однак в цьому прикладі немає ніякого коду, специфічного для PhantomJS ... ну, крім останнього рядка. Це важливий рядок для кожного скрипта PhantomJS, тому що він завершує сценарій. Це може не мати сенсу тут, але пам'ятайте, що JavaScript не завжди виконується лінійно. Наприклад, ви можете помістити виклик `exit ()` в функцію зворотного виклику.

Давайте розглянемо більш складний приклад.
___
### Завантаження сторінок
Використовуючи API PhantomJS, ми можемо завантажити будь-який URL-адресу та працювати зі сторінкою з двох точок зору:

- як JavaScript на сторінці.
- як користувач, що переглядає сторінку.

Почнемо з завантаження сторінки. Створимо новий файл сценарію і додамо наступний код:
***page.js***
```
var page = require('webpage').create();

page.open('http://net.tutsplus.com', function (s) {
    console.log(s);
    phantom.exit();
});
```

Ми починаємо з завантаження модуля PhantomJS `webpage` і створення об'єкта веб-сторінки. Потім ми викликаємо метод `open`, передаючи йому URL-адресу та функцію зворотного виклику; всередині цієї функції зворотного виклику ми можемо взаємодіяти з фактичної сторінкою. У наведеному вище прикладі ми просто реєструємо статус запиту, що надається параметром функції зворотного виклику. Якщо запустити цей скрипт, ми отримаємо статус «success», надрукований в терміналі:
![image](https://user-images.githubusercontent.com/54907481/119245604-4a80d880-bb83-11eb-9fd4-e75403a174d4.png)

Але давайте зробимо приклад ще більш цікавим, завантаживши сторінку і виконавши над нею JavaScript код. Почнемо з наведеного вище коду, але потім ми викликаємо `page.evaluate`:
```
page.open('https://code.tutsplus.com/', function () {
    var title = page.evaluate(function () {
        var posts = document.getElementsByClassName("post");
        posts[0].style.backgroundColor = "#000000";
        return document.title;
    });
    page.clipRect = { top: 0, left: 0, width: 600, height: 700 };
    page.render(title + ".png");
    phantom.exit();
});
```
Функція, яку ми передаємо на `page.evaluate`, виконується як JavaScript на завантаженій веб-сторінці. В цьому випадку ми знаходимо всі елементи з класом `post`; потім ми встановлюємо фон першого поста в чорний. Нарешті, ми повертаємо `document.title`. Це зручна можливість - повертати значення з нашого зворотного виклику `evaluate` і привласнювати його змінної (в даному випадку, `title`).

Потім ми встановлюємо `clipRect` на сторінці; це розміри екрану, який ми знімаємо за допомогою методу `render`. Як ви можете бачити, ми встановлюємо `top` і `left` значення щоб встановити початкової точки, а також встановлюємо `width` і `height`. Нарешті, ми викликаємо `page.render`, передаючи йому ім'я для файлу (змінна `title`). Потім завершуємо викликом `phantom.exit ().`

Тепер запустимо цей скрипт, і у нас повинно вийти зображення, яке виглядає приблизно так:


[1]: https://phantomjs.org/download.html "сторінці завантаження PhantomJS"